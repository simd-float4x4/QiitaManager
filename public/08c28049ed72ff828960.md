---
title: 【Swift】Realmのマイグレーション対応
tags:
  - Swift
  - Realm
private: false
updated_at: '2025-10-27T15:09:50+09:00'
id: 08c28049ed72ff828960
organization_url_name: null
slide: false
ignorePublish: false
---
### 概要
* `Realm.Configuration`の中にある`migrationBlock`ブロックの中で`oldSchemaVersion`によって、カラムの変更を追記していく。

### 参考コード

```Swift
 private func setupRealmMigration() {
        let config = Realm.Configuration(
            schemaVersion: 1,
            migrationBlock: { migration, oldSchemaVersion in
                if oldSchemaVersion < 1 {
                    migration.enumerateObjects(ofType: Todo.className()) { _, newObject in
                        newObject!["isDelete"] = false
                    }
                } else if oldSchemaVersion < 2 {
                    migration.enumerateObjects(ofType: Todo.className()) { _, newObject in
                        newObject!["isFavorite"] = false
                    }
                }
            }
        )
        Realm.Configuration.defaultConfiguration = config
    }
```

### 解説
* `OldSchemaVersion`が1の時かつデータを追加してしまった際に、テーブルに「isDelete」というカラムを追加した。
* 下記のコードを追加して、アプリの端末の`oldSchemaVersion`が1未満であれば、すべてのオブジェクトに初期値がfalseである`isDelete`を追加する
```Swift
if oldSchemaVersion < 1 {
    migration.enumerateObjects(ofType: Todo.className()) { _, newObject in
        newObject!["isDelete"] = false
    }
}
```
* `OldSchemaVersion`が2の時に、テーブルに「isFavorite」というカラムを追加した。
* 下記のコードを追加して、アプリの端末の`oldSchemaVersion`が1以上2未満であれば、すべてのオブジェクトに初期値がfalseである`isFavorite`を追加する
```Swift
} else if oldSchemaVersion < 2 {
    migration.enumerateObjects(ofType: Todo.className()) { _, newObject in
        newObject!["isFavorite"] = false
    }
}
```
