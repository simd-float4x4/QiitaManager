---
title: 【SwiftUI】SwiftUIでUIDocumentPickerViewControllerを初めて使ってみた
tags:
  - SwiftUI
private: false
updated_at: '2025-10-17T18:12:18+09:00'
id: 4e6e4ee4ec097de73523
organization_url_name: null
slide: false
ignorePublish: false
---
### 実現しようとしたこと

* 端末の中に保存されているファイルのアップロードを実現しようとした
* 下から画面がにゅっと出てきて端末の中に保存されているファイル一覧が表示される処理を実現しようとした


### 方針

* どうやら`UIDocumentPickerViewController`なるものを使うことでそれが実現できるらしい
* `SwiftUI`にはそれを実現できる方法がないので`UIKit`の`UIDocumentPickerViewController`というコントローラーを`ViewControllerRepresentable`を用いてラップすることで、むりくり実現が出来る。

### 解決策


#### DocumentPickerクラスの準備

* 事前準備として、`DocumentPicker`というクラスを準備しておく。

```DocumentPicker.swift
import SwiftUI
import UIKit
import UniformTypeIdentifiers

struct DocumentPicker: UIViewControllerRepresentable {
    var onPick: (URL) -> Void
    
    func makeUIViewController(context: Context) -> some UIViewController {
        let picker = UIDocumentPickerViewController(forOpeningContentTypes: [.item], asCopy: true)
        picker.delegate = context.coordinator
        picker.allowsMultipleSelection = false
        return picker
    }
    
    func updateUIViewController(_ uiViewController: UIViewControllerType, context: Context) {}
    
    func makeCoordinator() -> Coordinator {
        Coordinator(onPick: onPick)
    }
    
    class Coordinator: NSObject, UIDocumentPickerDelegate {
        var onPick: (URL) -> Void
        
        init(onPick: @escaping (URL) -> Void) {
            self.onPick = onPick
        }
        
        func documentPicker(_ controller: UIDocumentPickerViewController, didPickDocumentsAt urls: [URL]) {
            onPick(urls.first!)
        }
    }
}


```

* `makeUIViewController`では端末からDocument一覧画面を開き、`delegate`に`Coordinator`を指定する。
* `Coorindator`の中ではアイテムがPickされた時のアイテムの登録処理の指定を行う
* `Coordinator` が `delegate` を橋渡しして画面に`URL`を返す

というのが大体の流れになります

#### Viewから呼び出す

```ContentView.swift
 @State private var selectedFileURL: URL?
 //　省略
 .sheet(isPresented: $showPicker) {
    DocumentPicker { url in
        selectedFileURL = url
        // do something
    }
}
```
* あとはViewからurlを取得することができるので任意の操作を行うという流れになります。

<br>

* `UIViewRepresentable`だと`makeUIView` `updateUIView`となるのに、それのController版だと`makeUIViewController` `updateUIViewController`になるのがかわいいなと思いました
