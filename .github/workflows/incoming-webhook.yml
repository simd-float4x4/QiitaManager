name: Slack Notification

on:
  push:
    branches:
      - main

env:
  SLACK_USERNAME: "DeployBot"
  SLACK_ICON: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
  SLACK_WEBHOOK: ${{ secrets.SLACK_INCOMING_HOOKS_URL }}

jobs:
  slack_notification:
    name: Notify Slack
    runs-on: ubuntu-latest

    steps:
      # -- Slack通知（成功） --
      - name: Notify Slack on Success
        uses: rtCamp/action-slack-notify@v2
        if: success()
        env:
          SLACK_TITLE: "Deploy / Success"
          SLACK_COLOR: good
          SLACK_MESSAGE: "デプロイが完了しました🚀"
        with:
          attachments: |
              [
                {
                  "color": "good",
                  "author_name": "${{ github.actor }}",
                  "author_icon": "${{ github.event.sender.avatar_url }}",
                  "fields": [
                    {
                      "title": "Commit Message",
                      "value": "${{ env.COMMIT_MESSAGE }}"
                    },
                    {
                      "title": "GitHub Actions URL",
                      "value": "${{ github.event.repository.url }}/actions/runs/${{ github.run_id }}"
                    },
                    {
                      "title": "Compare URL",
                      "value": "${{ github.event.compare }}"
                    }
                  ]
                }
              ]

      # -- Slack通知（失敗） --
      - name: Notify Slack on Failure
        uses: rtCamp/action-slack-notify@v2
        if: failure()
        env:
          SLACK_TITLE: "Deploy / Failure"
          SLACK_COLOR: danger
          SLACK_MESSAGE: "デプロイが失敗しました😢"
